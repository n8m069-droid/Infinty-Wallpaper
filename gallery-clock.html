<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Gallery Clock</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,700;1,300&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Share+Tech+Mono&family=Cinzel:wght@400;700&family=Righteous&family=Orbitron:wght@400;700;900&family=Caveat:wght@400;700&family=Josefin+Sans:wght@100;300;400&family=Cormorant+Garamond:ital,wght@0,300;0,600;1,300&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #000;
}

/* ── BACKGROUND ── */
#bg, #bg2 {
  position: fixed;
  inset: 0;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  transition: opacity 0.8s cubic-bezier(.4,0,.2,1);
}
#bg2 { opacity: 0; z-index: 1; }

.overlay {
  position: fixed;
  inset: 0;
  z-index: 2;
  background: linear-gradient(
    160deg,
    rgba(0,0,0,0.25) 0%,
    rgba(0,0,0,0) 35%,
    rgba(0,0,0,0) 55%,
    rgba(0,0,0,0.65) 100%
  );
  pointer-events: none;
}

/* ── LOADING BAR ── */
#loadBar {
  position: fixed;
  top: 0; left: 0;
  height: 3px;
  width: 0;
  background: rgba(255,255,255,0.8);
  z-index: 100;
  transition: width 0.4s ease, opacity 0.4s ease;
}

/* ── UI LAYER ── */
.ui {
  position: fixed;
  inset: 0;
  z-index: 3;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: clamp(16px, 3vw, 48px);
  pointer-events: none;
}

/* ── TOP BAR ── */
.top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
}

.brand {
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 100;
  font-size: clamp(11px, 1.2vw, 16px);
  letter-spacing: 0.4em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.5);
  text-shadow: 0 1px 8px rgba(0,0,0,0.5);
}

.img-count {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(11px, 1vw, 14px);
  color: rgba(255,255,255,0.35);
  letter-spacing: 0.15em;
}

/* ── CLOCK CONTAINER ── */
#clockWrap {
  position: absolute;
  /* position is set by JS per style */
  z-index: 4;
  pointer-events: none;
  transition: opacity 0.5s ease;
}
#clockWrap.hidden { opacity: 0; }

/* ── BOTTOM BAR ── */
.bottom {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
}

.photo-info { max-width: 55%; }

.photo-author {
  font-family: 'DM Sans', sans-serif;
  font-weight: 300;
  font-size: clamp(10px, 1.1vw, 14px);
  color: rgba(255,255,255,0.45);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin-bottom: 4px;
  text-shadow: 0 1px 6px rgba(0,0,0,0.6);
}

.photo-id {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(9px, 0.9vw, 12px);
  color: rgba(255,255,255,0.25);
}

/* ── NEXT BUTTON ── */
#nextBtn {
  pointer-events: all;
  display: flex;
  align-items: center;
  gap: 12px;
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.2);
  color: #fff;
  cursor: pointer;
  padding: clamp(10px,1.5vw,16px) clamp(16px,2.5vw,32px);
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 300;
  font-size: clamp(11px, 1.2vw, 15px);
  letter-spacing: 0.25em;
  text-transform: uppercase;
  outline: none;
  border-radius: 2px;
  transition: background 0.25s, border-color 0.25s, transform 0.1s;
  flex-shrink: 0;
}
#nextBtn:hover {
  background: rgba(255,255,255,0.22);
  border-color: rgba(255,255,255,0.4);
}
#nextBtn:active { transform: scale(0.97); }
#nextBtn svg {
  width: clamp(14px,1.5vw,20px);
  height: clamp(14px,1.5vw,20px);
  stroke: rgba(255,255,255,0.8);
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: transform 0.3s;
}
#nextBtn:hover svg { transform: translateX(4px); }

/* ══════════════════════════════════════════
   CLOCK STYLES
══════════════════════════════════════════ */

/* 1. MINIMAL DIGITAL — large mono numbers, top-right */
.clock-minimal-digital {
  top: clamp(16px,3vw,48px);
  right: clamp(16px,3vw,48px);
  text-align: right;
}
.clock-minimal-digital .time {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(36px, 6vw, 96px);
  color: #fff;
  letter-spacing: -0.02em;
  line-height: 1;
  text-shadow: 0 0 40px rgba(255,255,255,0.3);
}
.clock-minimal-digital .date {
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 100;
  font-size: clamp(10px, 1vw, 14px);
  color: rgba(255,255,255,0.4);
  letter-spacing: 0.4em;
  text-transform: uppercase;
  margin-top: 4px;
}

/* 2. ANALOG CANVAS — center-bottom */
.clock-analog {
  bottom: clamp(80px,12vw,140px);
  left: 50%;
  transform: translateX(-50%);
}
.clock-analog canvas { display: block; }

/* 3. NEON RETRO — center */
.clock-neon {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.clock-neon .time {
  font-family: 'Orbitron', monospace;
  font-weight: 900;
  font-size: clamp(40px, 7vw, 110px);
  color: #0ff;
  text-shadow: 0 0 10px #0ff, 0 0 30px #0ff, 0 0 60px #0af, 0 0 100px #06f;
  letter-spacing: 0.06em;
  line-height: 1;
  animation: neonPulse 2s ease-in-out infinite;
}
.clock-neon .date {
  font-family: 'Orbitron', monospace;
  font-size: clamp(9px, 1vw, 13px);
  color: rgba(0,255,255,0.5);
  letter-spacing: 0.3em;
  margin-top: 8px;
  text-transform: uppercase;
}
@keyframes neonPulse {
  0%,100% { opacity: 1; }
  50% { opacity: 0.85; }
}

/* 4. SERIF EDITORIAL — top-left vertical */
.clock-editorial {
  top: 50%;
  left: clamp(16px,3vw,48px);
  transform: translateY(-50%);
}
.clock-editorial .time {
  font-family: 'Playfair Display', serif;
  font-style: italic;
  font-size: clamp(48px, 8vw, 130px);
  color: rgba(255,255,255,0.9);
  line-height: 0.9;
  text-shadow: 2px 4px 30px rgba(0,0,0,0.6);
  writing-mode: vertical-rl;
  text-orientation: mixed;
  letter-spacing: -0.05em;
}
.clock-editorial .date {
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 100;
  font-size: clamp(8px, 0.9vw, 12px);
  color: rgba(255,255,255,0.4);
  letter-spacing: 0.35em;
  text-transform: uppercase;
  margin-top: 12px;
  writing-mode: vertical-rl;
}

/* 5. HANDWRITTEN — bottom-left casual */
.clock-handwritten {
  bottom: clamp(80px,12vw,140px);
  left: clamp(16px,3vw,48px);
}
.clock-handwritten .time {
  font-family: 'Caveat', cursive;
  font-weight: 700;
  font-size: clamp(52px, 9vw, 140px);
  color: rgba(255,255,255,0.92);
  line-height: 1;
  text-shadow: 1px 2px 20px rgba(0,0,0,0.5);
  letter-spacing: -0.02em;
}
.clock-handwritten .date {
  font-family: 'Caveat', cursive;
  font-size: clamp(14px, 1.8vw, 24px);
  color: rgba(255,255,255,0.5);
  margin-top: -4px;
}

/* 6. BRUTALIST STACKED — top-center bold blocks */
.clock-brutalist {
  top: clamp(16px,3vw,48px);
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
}
.clock-brutalist .time {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(60px,10vw,160px);
  color: #fff;
  letter-spacing: 0.08em;
  line-height: 0.85;
  -webkit-text-stroke: 1px rgba(255,255,255,0.5);
  text-stroke: 1px rgba(255,255,255,0.5);
  text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
}
.clock-brutalist .date {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(12px, 1.5vw, 20px);
  color: rgba(255,255,255,0.35);
  letter-spacing: 0.3em;
  margin-top: 2px;
}

/* 7. CINZEL ROMAN — center-top luxe */
.clock-roman {
  top: clamp(16px,3vw,48px);
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  white-space: nowrap;
}
.clock-roman .time {
  font-family: 'Cinzel', serif;
  font-weight: 700;
  font-size: clamp(32px, 5.5vw, 88px);
  color: rgba(255,235,180,0.95);
  letter-spacing: 0.15em;
  text-shadow: 0 2px 20px rgba(180,130,0,0.5);
}
.clock-roman .date {
  font-family: 'Cinzel', serif;
  font-weight: 400;
  font-size: clamp(9px, 1vw, 13px);
  color: rgba(255,220,140,0.45);
  letter-spacing: 0.4em;
  text-transform: uppercase;
  margin-top: 6px;
}

/* 8. CORMORANT MINIMAL — bottom-right italic whisper */
.clock-whisper {
  bottom: clamp(80px,12vw,140px);
  right: clamp(16px,3vw,48px);
  text-align: right;
}
.clock-whisper .time {
  font-family: 'Cormorant Garamond', serif;
  font-style: italic;
  font-weight: 300;
  font-size: clamp(44px, 7.5vw, 120px);
  color: rgba(255,255,255,0.85);
  line-height: 1;
  letter-spacing: -0.03em;
  text-shadow: 0 2px 24px rgba(0,0,0,0.4);
}
.clock-whisper .date {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(11px, 1.1vw, 16px);
  color: rgba(255,255,255,0.35);
  letter-spacing: 0.25em;
  margin-top: 2px;
}

/* 9. SEGMENTED LCD — bottom-center retro green */
.clock-lcd {
  bottom: clamp(80px,12vw,140px);
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  background: rgba(0,20,0,0.55);
  border: 1px solid rgba(0,255,100,0.2);
  padding: clamp(8px,1.5vw,20px) clamp(16px,3vw,40px);
  backdrop-filter: blur(6px);
  border-radius: 4px;
}
.clock-lcd .time {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(36px, 6vw, 96px);
  color: #3f9;
  text-shadow: 0 0 8px #3f9, 0 0 20px rgba(0,255,100,0.4);
  letter-spacing: 0.1em;
  line-height: 1;
}
.clock-lcd .date {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(10px, 1vw, 13px);
  color: rgba(51,255,153,0.45);
  letter-spacing: 0.3em;
  margin-top: 4px;
}

/* 10. RIGHTEOUS SPLIT — diagonal two-part top-right */
.clock-split {
  top: clamp(16px,3vw,48px);
  right: clamp(16px,3vw,48px);
  text-align: right;
}
.clock-split .hours {
  font-family: 'Righteous', cursive;
  font-size: clamp(64px,11vw,180px);
  color: #fff;
  line-height: 0.85;
  text-shadow: 3px 3px 0 rgba(0,0,0,0.25);
  letter-spacing: -0.04em;
}
.clock-split .mins {
  font-family: 'Righteous', cursive;
  font-size: clamp(64px,11vw,180px);
  color: transparent;
  -webkit-text-stroke: 2px rgba(255,255,255,0.5);
  text-stroke: 2px rgba(255,255,255,0.5);
  line-height: 0.85;
  letter-spacing: -0.04em;
}
.clock-split .date {
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 100;
  font-size: clamp(9px, 0.9vw, 13px);
  color: rgba(255,255,255,0.35);
  letter-spacing: 0.4em;
  text-transform: uppercase;
  margin-top: 6px;
}
</style>
</head>
<body>

<div id="loadBar"></div>
<div id="bg"></div>
<div id="bg2"></div>
<div class="overlay"></div>

<!-- Clock container (positioned + styled by JS) -->
<div id="clockWrap" class="hidden"></div>

<div class="ui">
  <div class="top">
    <div class="brand">Gallery · Clock</div>
    <div class="img-count" id="imgCount">— / —</div>
  </div>
  <div class="bottom">
    <div class="photo-info">
      <div class="photo-author" id="photoAuthor"></div>
      <div class="photo-id" id="photoId"></div>
    </div>
    <button id="nextBtn">
      Double-tap anywhere
      <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </button>
  </div>
</div>

<script>
// ══════════════════════════════════════════
//  CONFIG
// ══════════════════════════════════════════
const TOTAL_IDS = 1000;
let imgPool = [];
let clockPool = [];
let imgCount = 0;
let activeClockStyle = null;
let clockTimer = null;
let currentBg = 'bg'; // alternates between bg and bg2
let analCanvas = null, analCtx = null;

// ══════════════════════════════════════════
//  POOL MANAGEMENT
// ══════════════════════════════════════════
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function buildImgPool() {
  imgPool = shuffle(Array.from({ length: TOTAL_IDS - 9 }, (_, i) => i + 10));
}

function buildClockPool() {
  clockPool = shuffle([
    'minimal-digital','analog','neon','editorial',
    'handwritten','brutalist','roman','whisper','lcd','split'
  ]);
}

function nextClockStyle() {
  if (clockPool.length === 0) buildClockPool();
  // avoid immediate repeat after full cycle
  let style = clockPool.shift();
  if (style === activeClockStyle && clockPool.length > 0) {
    clockPool.push(style);
    style = clockPool.shift();
  }
  activeClockStyle = style;
  return style;
}

// ══════════════════════════════════════════
//  LOADING BAR
// ══════════════════════════════════════════
const loadBar = document.getElementById('loadBar');
function barStart() { loadBar.style.width = '55%'; loadBar.style.opacity = '1'; }
function barDone()  {
  loadBar.style.width = '100%';
  setTimeout(() => { loadBar.style.opacity = '0'; loadBar.style.width = '0'; }, 350);
}

// ══════════════════════════════════════════
//  TIME HELPERS
// ══════════════════════════════════════════
function pad(n) { return String(n).padStart(2,'0'); }

function timeStr(d, ampm) {
  let h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();
  if (ampm) {
    const suf = h >= 12 ? 'PM' : 'AM';
    h = h % 12 || 12;
    return `${pad(h)}:${pad(m)}:${pad(s)} ${suf}`;
  }
  return `${pad(h)}:${pad(m)}:${pad(s)}`;
}

function hhmm(d) {
  return `${pad(d.getHours()%12||12)}:${pad(d.getMinutes())}`;
}

const DAYS = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const MONTHS = ['January','February','March','April','May','June',
                'July','August','September','October','November','December'];
function dateStr(d) {
  return `${DAYS[d.getDay()]}, ${MONTHS[d.getMonth()]} ${d.getDate()}`;
}
function shortDate(d) {
  return `${MONTHS[d.getMonth()].slice(0,3).toUpperCase()} ${d.getDate()} · ${d.getFullYear()}`;
}

// Roman numeral helper
function toRoman(n) {
  const vals = [1000,900,500,400,100,90,50,40,10,9,5,4,1];
  const syms = ['M','CM','D','CD','C','XC','L','XL','X','IX','V','IV','I'];
  let out = '';
  vals.forEach((v,i) => { while(n>=v){ out+=syms[i]; n-=v; } });
  return out;
}

// ══════════════════════════════════════════
//  CLOCK RENDERERS
// ══════════════════════════════════════════
function renderAnalog() {
  if (!analCtx || !analCanvas) return;
  const size = analCanvas.width;
  const cx = size/2, cy = size/2, r = size/2 - 4;
  const d = new Date();
  const h = d.getHours()%12, m = d.getMinutes(), s = d.getSeconds();
  const ctx = analCtx;

  ctx.clearRect(0,0,size,size);

  // Face
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.fillStyle = 'rgba(0,0,0,0.35)';
  ctx.fill();
  ctx.strokeStyle = 'rgba(255,255,255,0.3)';
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // Hour ticks
  for (let i=0; i<12; i++) {
    const a = (i/12)*Math.PI*2 - Math.PI/2;
    const len = i%3===0 ? r*0.12 : r*0.06;
    ctx.beginPath();
    ctx.moveTo(cx + Math.cos(a)*(r-len), cy + Math.sin(a)*(r-len));
    ctx.lineTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r);
    ctx.strokeStyle = i%3===0 ? 'rgba(255,255,255,0.8)' : 'rgba(255,255,255,0.35)';
    ctx.lineWidth = i%3===0 ? 2 : 1;
    ctx.stroke();
  }

  function hand(angle, len, width, color) {
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(angle)*len, cy + Math.sin(angle)*len);
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.lineCap = 'round';
    ctx.stroke();
  }

  const ha = ((h + m/60)/12)*Math.PI*2 - Math.PI/2;
  const ma = ((m + s/60)/60)*Math.PI*2 - Math.PI/2;
  const sa = (s/60)*Math.PI*2 - Math.PI/2;

  hand(ha, r*0.52, 4, 'rgba(255,255,255,0.95)');
  hand(ma, r*0.72, 2.5, 'rgba(255,255,255,0.9)');
  hand(sa, r*0.78, 1.5, '#f85');

  // Center dot
  ctx.beginPath();
  ctx.arc(cx,cy,4,0,Math.PI*2);
  ctx.fillStyle = '#fff';
  ctx.fill();
}

const CLOCK_BUILDERS = {
  'minimal-digital': (wrap) => {
    wrap.className = 'clock-minimal-digital';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, true);
      document.getElementById('cd').textContent = dateStr(d).toUpperCase();
    };
  },
  'analog': (wrap) => {
    const size = Math.round(Math.min(window.innerWidth, window.innerHeight) * 0.22);
    wrap.className = 'clock-analog';
    wrap.innerHTML = `<canvas id="analCvs" width="${size}" height="${size}"></canvas>`;
    analCanvas = document.getElementById('analCvs');
    analCtx = analCanvas.getContext('2d');
    return renderAnalog;
  },
  'neon': (wrap) => {
    wrap.className = 'clock-neon';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, false);
      document.getElementById('cd').textContent = shortDate(d);
    };
  },
  'editorial': (wrap) => {
    wrap.className = 'clock-editorial';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, false);
      document.getElementById('cd').textContent = shortDate(d);
    };
  },
  'handwritten': (wrap) => {
    wrap.className = 'clock-handwritten';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = hhmm(d);
      document.getElementById('cd').textContent = dateStr(d);
    };
  },
  'brutalist': (wrap) => {
    wrap.className = 'clock-brutalist';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, false);
      document.getElementById('cd').textContent = shortDate(d);
    };
  },
  'roman': (wrap) => {
    wrap.className = 'clock-roman';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      const h = d.getHours()%12||12, m = d.getMinutes();
      document.getElementById('ct').textContent = `${toRoman(h)} · ${toRoman(m||60)}`;
      document.getElementById('cd').textContent = `${DAYS[d.getDay()].toUpperCase()} · ${MONTHS[d.getMonth()].toUpperCase()} ${toRoman(d.getDate())}`;
    };
  },
  'whisper': (wrap) => {
    wrap.className = 'clock-whisper';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, true);
      document.getElementById('cd').textContent = dateStr(d);
    };
  },
  'lcd': (wrap) => {
    wrap.className = 'clock-lcd';
    wrap.innerHTML = `<div class="time" id="ct"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ct').textContent = timeStr(d, false);
      document.getElementById('cd').textContent = shortDate(d);
    };
  },
  'split': (wrap) => {
    wrap.className = 'clock-split';
    wrap.innerHTML = `<div class="hours" id="ch"></div><div class="mins" id="cm"></div><div class="date" id="cd"></div>`;
    return () => {
      const d = new Date();
      document.getElementById('ch').textContent = pad(d.getHours()%12||12);
      document.getElementById('cm').textContent = pad(d.getMinutes());
      document.getElementById('cd').textContent = shortDate(d);
    };
  }
};

// ══════════════════════════════════════════
//  ACTIVATE A CLOCK STYLE
// ══════════════════════════════════════════
function activateClock(style) {
  clearInterval(clockTimer);
  analCanvas = null; analCtx = null;
  const wrap = document.getElementById('clockWrap');
  wrap.className = 'hidden';
  wrap.removeAttribute('style');

  setTimeout(() => {
    const tick = CLOCK_BUILDERS[style](wrap);
    tick();
    clockTimer = setInterval(tick, 1000);
    wrap.classList.remove('hidden');
  }, 400);
}

// ══════════════════════════════════════════
//  IMAGE LOADING
// ══════════════════════════════════════════
async function fetchInfo(id) {
  try {
    const r = await fetch(`https://picsum.photos/id/${id}/info`);
    return r.ok ? r.json() : null;
  } catch { return null; }
}

async function showNext() {
  document.getElementById('nextBtn').disabled = true;
  barStart();

  if (imgPool.length === 0) buildImgPool();
  const id = imgPool.shift();
  imgCount++;

  const W = window.innerWidth, H = window.innerHeight;
  const url = `https://picsum.photos/id/${id}/${W}/${H}`;

  const [info] = await Promise.all([
    fetchInfo(id),
    new Promise(res => {
      const img = new Image(); img.src = url;
      img.onload = res; img.onerror = res;
    })
  ]);

  // Crossfade backgrounds
  const frontId = currentBg === 'bg' ? 'bg2' : 'bg';
  const backId  = currentBg;
  const front = document.getElementById(frontId);
  const back  = document.getElementById(backId);

  front.style.backgroundImage = `url('${url}')`;
  front.style.zIndex = '1';
  front.style.opacity = '0';

  // Force reflow
  front.getBoundingClientRect();

  back.style.zIndex = '0';
  front.style.opacity = '1';

  setTimeout(() => {
    back.style.backgroundImage = '';
  }, 900);

  currentBg = frontId;

  // Update info
  document.getElementById('imgCount').textContent = `${String(imgCount).padStart(3,'0')}`;
  document.getElementById('photoAuthor').textContent = info ? `Photo · ${info.author}` : `Photo #${id}`;
  document.getElementById('photoId').textContent = info ? `Picsum ID ${id}` : '';

  // Switch clock
  activateClock(nextClockStyle());

  barDone();
  document.getElementById('nextBtn').disabled = false;
}

// ══════════════════════════════════════════
//  INIT
// ══════════════════════════════════════════
buildImgPool();
buildClockPool();
showNext();

// ── Double-tap / double-click anywhere to advance ──
let lastTap = 0;
const DBL_DELAY = 300; // ms

function handleDoubleTap() {
  if (!document.getElementById('nextBtn').disabled) showNext();
}

// Touch: double-tap
document.addEventListener('touchend', e => {
  const now = Date.now();
  if (now - lastTap < DBL_DELAY) {
    e.preventDefault();
    handleDoubleTap();
  }
  lastTap = now;
}, { passive: false });

// Mouse: double-click
document.addEventListener('dblclick', e => {
  handleDoubleTap();
});

// Keep button functional too (pointer-events: all)
document.getElementById('nextBtn').addEventListener('click', e => {
  e.stopPropagation();
  if (!document.getElementById('nextBtn').disabled) showNext();
});

// Resize: rebuild analog if active
window.addEventListener('resize', () => {
  if (activeClockStyle === 'analog' && analCanvas) {
    const size = Math.round(Math.min(window.innerWidth, window.innerHeight) * 0.22);
    analCanvas.width = size;
    analCanvas.height = size;
  }
});
</script>
</body>
</html>
